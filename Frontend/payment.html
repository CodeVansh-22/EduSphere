<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Secure Payment | EduSphere</title>
    <link rel="stylesheet" href="css/payment.css">
</head>
<body>

    <!-- MAIN CONTAINER -->
    <div class="payment-container">

        <!-- LEFT SECTION -->
        <div class="payment-details">
            <h1>EduSphere</h1>
            <p class="price-title">Total Payable</p>
            <h2 id="disp-price">â‚¹0</h2>
            <p id="disp-title">Course Name</p>

            <div class="transaction-info">
                <p><b id="disp-user">Guest User</b></p>
                <p>Transaction ID: #EDU-88392</p>
            </div>
        </div>

        <!-- RIGHT SECTION -->
        <div class="payment-options">
            <h2>Payment Options</h2>

            <div class="tabs">
                <button id="tab-card" onclick="switchTab('card')" class="active">Card</button>
                <button id="tab-netbank" onclick="switchTab('netbank')">NetBank</button>
                <button id="tab-upi" onclick="switchTab('upi')">UPI</button>
            </div>

            <!-- CARD SECTION -->
            <div id="section-card">
                <form onsubmit="confirmPayment(event)">
                    <div class="input-box">
                        <label>Card Number</label>
                        <input type="text" placeholder="0000 0000 0000 0000">
                    </div>

                    <div class="input-row">
                        <div class="input-box">
                            <label>Expiry (MM/YY)</label>
                            <input type="text" placeholder="MM / YY">
                        </div>
                        <div class="input-box">
                            <label>CVV</label>
                            <input type="text" placeholder="123">
                        </div>
                    </div>

                    <div class="input-box">
                        <label>Card Holder Name</label>
                        <input type="text" placeholder="Name on card">
                    </div>

                    <button id="pay-btn-card" type="submit" class="pay-btn">Pay</button>
                </form>
            </div>

            <!-- NETBANK SECTION -->
            <div id="section-netbank" class="hidden">
                <form onsubmit="confirmPayment(event)">
                    <div class="input-box">
                        <label>Select Bank</label>
                        <input type="text" placeholder="HDFC, SBI, ICICI...">
                    </div>
                    <button id="pay-btn-netbank" type="submit" class="pay-btn">Pay</button>
                </form>
            </div>

            <!-- UPI SECTION -->
            <div id="section-upi" class="hidden">
                <form onsubmit="confirmPayment(event)">
                    <div class="input-box">
                        <label>Enter UPI ID</label>
                        <input type="text" placeholder="example@upi">
                    </div>
                    <button id="pay-btn-upi" type="submit" class="pay-btn">Pay</button>
                </form>
            </div>
        </div>
    </div>

    <!-- LOAD script.js FIRST (IMPORTANT) -->
    <script src="script.js"></script>

    <!-- LOAD Razorpay Checkout Script -->
    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>

    <!-- CUSTOM LOGIC -->
    <script>
        /* ------------ TAB SWITCHING ------------ */
        function switchTab(name) {
            document.getElementById("section-card").classList.add("hidden");
            document.getElementById("section-netbank").classList.add("hidden");
            document.getElementById("section-upi").classList.add("hidden");

            document.getElementById("tab-card").classList.remove("active");
            document.getElementById("tab-netbank").classList.remove("active");
            document.getElementById("tab-upi").classList.remove("active");

            document.getElementById("section-" + name).classList.remove("hidden");
            document.getElementById("tab-" + name).classList.add("active");
        }

        /* ------------ LOAD COURSE DETAILS ------------ */
        window.onload = function () {
            const courseId = localStorage.getItem("selectedCourse");
            const username = localStorage.getItem("currentUserName") || "Guest User";

            document.getElementById("disp-user").innerText = username;

            if (courseId && courseData[courseId]) {
                const c = courseData[courseId];
                document.getElementById("disp-price").innerText = c.price;
                document.getElementById("disp-title").innerText = c.title;

                document.getElementById("pay-btn-card").innerText = "Pay " + c.price;
                document.getElementById("pay-btn-netbank").innerText = "Pay " + c.price;
                document.getElementById("pay-btn-upi").innerText = "Pay " + c.price;
            }
        };

        /* ------------ RAZORPAY PAYMENT LOGIC ------------ */
        async function confirmPayment(e) {
            e.preventDefault();

            const priceText = document.getElementById("disp-price").innerText;
            const amount = parseInt(priceText.replace(/[^0-9]/g, ""));

            if (!amount || amount <= 0) {
                alert("Invalid course amount");
                return;
            }

            const API_URL = "https://edusphere-backend-3jac.onrender.com/api";

            const res = await fetch(`${API_URL}/create-order`, {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify({ amount })
            });

            const order = await res.json();

            const options = {
                key: "rzp_test_RnqzlJgS6MFe2M",
                amount: order.amount,
                currency: "INR",
                name: "EduSphere",
                description: "Course Purchase",
                order_id: order.id,

                handler: function (response) {
                    alert("Payment Successful! ID: " + response.razorpay_payment_id);
                    window.location.href = "Course.html";
                },

                theme: {
                    color: "#38bdf8"
                }
            };

            const rzp = new Razorpay(options);
            rzp.open();
        }
    </script>

</body>
</html>
